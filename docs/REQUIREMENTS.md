# 要件定義書 (REQUIREMENTS.md)

## 1. プロジェクト概要

### 1.1 プロジェクト名
Element Inspector Lite

### 1.2 バージョン
v1.0.0

### 1.3 目的
Chrome拡張機能開発の基礎を学びながら、Webページの要素情報を取得・表示する機能を実装する。

### 1.4 背景
最終的に「SASS形式でネストされたCSS情報を抽出する拡張機能」を開発するための学習ステップとして、まずはシンプルな要素情報の取得機能を実装する。

---

## 2. 機能要件

### 2.1 必須機能（Must Have）

#### FR-001: Inspectモード切り替え
- **説明**: DevToolsパネル/ポップアップからInspectモードのON/OFFを切り替えられる
- **入力**: ボタンクリック
- **出力**: モード状態の変更、ボタンテキストの更新
- **受け入れ基準**:
  - [x] ボタンクリックでモードが切り替わる
  - [x] 現在のモード状態がボタンテキストに反映される
  - [x] モード状態がタブ間で保持される

#### FR-002: 要素選択
- **説明**: Inspectモード中、ページ上の要素をクリックで選択できる
- **入力**: 要素のクリック
- **出力**: 選択された要素の参照
- **受け入れ基準**:
  - [x] クリックした要素が選択される
  - [x] クリックイベントの伝播が停止される（リンク遷移等の防止）
  - [x] 選択時にデフォルトの動作が発生しない

#### FR-003: ホバーハイライト
- **説明**: Inspectモード中、マウスホバーで要素をハイライト表示する
- **入力**: マウスホバー
- **出力**: 要素の視覚的なハイライト
- **受け入れ基準**:
  - [x] ホバー中の要素に青いアウトライン
  - [x] ホバーを外すとアウトラインが消える
  - [x] 元のページのスタイルに影響を与えない

#### FR-004: 要素情報の取得
- **説明**: 選択された要素から以下の情報を取得する
- **取得項目**:
  - タグ名（小文字）
  - ID属性（存在する場合）
  - クラス名リスト（複数可）
  - 直接の子要素の数
- **受け入れ基準**:
  - [x] タグ名が正しく取得される
  - [x] IDが存在する場合のみ表示される
  - [x] 複数のクラスが配列として取得される
  - [x] 子要素数が正しくカウントされる

#### FR-005: 情報表示（DevToolsパネル）
- **説明**: 取得した要素情報をDevToolsパネルに表示する
- **入力**: 要素情報オブジェクト
- **出力**: 整形されたHTML表示
- **受け入れ基準**:
  - [x] 各項目がラベル付きで表示される
  - [x] 未選択時は「要素を選択してください」と表示
  - [x] クラスが複数ある場合はカンマ区切りで表示
  - [x] **パネルが閉じずに情報が表示される**

#### FR-006: ESCキーでキャンセル
- **説明**: Inspectモード中にESCキーでモードを終了できる
- **入力**: ESCキー押下
- **出力**: Inspectモード終了
- **受け入れ基準**:
  - [x] ESCキーでモードが終了する
  - [x] ハイライトが解除される
  - [x] DevToolsパネルに通知される

#### FR-007: 選択履歴
- **説明**: 過去に選択した要素の履歴を保持する
- **入力**: 要素選択
- **出力**: 履歴リストへの追加
- **受け入れ基準**:
  - [x] 最新10件の履歴を保持
  - [x] 履歴をクリックで再表示
  - [x] セレクタ形式で表示（`<tag>#id.class`）

### 2.2 Step 2機能（CSS Property Inspector）✅ 完了

#### FR-008: CSSプロパティ取得
- **説明**: 選択した要素のCSSプロパティを`getComputedStyle()`で取得する
- **取得項目**: 主要プロパティ約50種類
  - レイアウト: display, position, top, right, bottom, left, z-index, float, clear
  - ボックスモデル: width, height, min-*, max-*, margin-*, padding-*, box-sizing
  - Flexbox: flex, flex-direction, flex-wrap, justify-content, align-items, gap
  - Grid: grid-template-columns, grid-template-rows, grid-column, grid-row
  - テキスト: color, font-family, font-size, font-weight, line-height, text-align
  - 背景: background, background-color, background-image, background-size
  - ボーダー: border, border-width, border-style, border-color, border-radius
  - その他: opacity, visibility, overflow, cursor, box-shadow, transform, transition
- **受け入れ基準**:
  - [x] `getComputedStyle()`でCSSプロパティを取得
  - [x] 主要プロパティのみをフィルタリング
  - [x] デフォルト値は非表示

#### FR-009: CSS表示UI
- **説明**: CSSプロパティをシンタックスハイライト風に表示する
- **入力**: CSSプロパティオブジェクト
- **出力**: スタイル付きのCSS表示
- **受け入れ基準**:
  - [x] プロパティ名と値を色分け表示
  - [x] 色の値にはカラープレビュー表示
  - [x] ダークモード対応

#### FR-010: CSSコピー機能
- **説明**: 取得したCSSプロパティをクリップボードにコピーする
- **入力**: コピーボタンクリック
- **出力**: クリップボードへの書き込み
- **受け入れ基準**:
  - [x] コピーボタンでCSSをコピー
  - [x] コピー完了時にフィードバック表示
  - [x] DevToolsパネルでも動作（`document.execCommand`フォールバック）

### 2.3 任意機能（Nice to Have）

#### FR-011: セレクタ生成
- **説明**: 選択した要素のCSSセレクタを自動生成する
- **出力例**: `div#main > ul.nav-list`

---

## 3. 非機能要件

### 3.1 パフォーマンス
- **NFR-001**: ホバーハイライトの遅延は50ms以下
- **NFR-002**: 要素情報の取得は100ms以下で完了

### 3.2 互換性
- **NFR-003**: Chrome バージョン 88 以上で動作
- **NFR-004**: Manifest V3 形式を使用

### 3.3 セキュリティ
- **NFR-005**: Content Security Policy を遵守
- **NFR-006**: 最小限の権限のみ要求（activeTab, scripting）

### 3.4 ユーザビリティ
- **NFR-007**: 直感的なUI（ボタン1つで操作開始）
- **NFR-008**: 日本語UIに対応
- **NFR-009**: DevToolsダークモードに対応

---

## 4. 制約条件

### 4.1 技術的制約
- Chrome Extensions Manifest V3 を使用すること
- 外部ライブラリは使用しない（Vanilla JSのみ）
- ES6+ の構文を使用可

### 4.2 対象外（スコープ外）
- Firefox/Safari など他ブラウザ対応
- ~~CSS情報の取得（Step 2以降で実装）~~ → ✅ Step 2で実装完了
- ネスト構造の解析（Step 3以降で実装）
- SASS形式出力（Step 4で実装）

---

## 5. 用語定義

| 用語 | 説明 |
|------|------|
| Inspectモード | 要素選択が有効な状態 |
| Content Script | Webページに注入されるスクリプト |
| Popup | 拡張機能アイコンクリック時に表示されるUI |
| DevToolsパネル | F12で開くDevTools内に表示されるカスタムパネル |
| Manifest | 拡張機能の設定ファイル（JSON） |
| Service Worker | バックグラウンドで動作するスクリプト（Manifest V3） |

---

## 6. 成功指標

### Step 1 (Element Inspector Lite)
1. ✅ 拡張機能がChromeに正常にインストールできる
2. ✅ 任意のWebサイトで要素選択が動作する
3. ✅ 選択した要素の情報が正しく表示される
4. ✅ モードのON/OFFが正常に切り替わる
5. ✅ DevToolsパネルで情報が継続的に表示される（ポップアップが閉じる問題を解決）
6. ✅ ESCキーでキャンセルできる
7. ✅ 選択履歴が保持される

### Step 2 (CSS Property Inspector)
8. ✅ 選択した要素のCSSプロパティが取得・表示される
9. ✅ デフォルト値がフィルタリングされ、意味のある値のみ表示される
10. ✅ CSSプロパティをクリップボードにコピーできる
11. ✅ 色の値にカラープレビューが表示される
12. ✅ ダークモードで適切に表示される
